= Hazelcast

This page covers how to use the Hazelcast functionality in Payara 4.1.1.162.

Hazelcast is an In-Memory Data Grid, providing Web and EJB session
persistence, and implementing JSR107 (JCache) in Payara Server.

== Enabling Hazelcast

In the default domain configuration of Payara, Hazelcast is not enabled.
It can be enabled either through the Admin Console, using a command line
_asadmin_ command, or through editing the _domain.xml_ file.

=== Enabling Hazelcast through the Admin Console

To enable Hazelcast for an instance:

* Select the instance's configuration from
the page tree:

image::/assets/hazelcast-admin-console-select-instance-config.png[Payara Server 4.1.2.172 Page Tree]

* Click the "Hazelcast" button to view the "Hazelcast
Configuration" page:

image::/assets/hazelcast-admin-console-select-hazelcast.png[Payara Server 4.1.2.172 Hazelcast Selection]

* Check "Enabled", and optionally "Dynamic" to apply
the configuration without a restart, and save.

image::/assets/hazelcast-admin-console-enable-hazelcast.png[Payara Server 4.1.2.172 Enabling Hazelcast]

=== Enabling Hazelcast using Asadmin

*Usage:* `asadmin> set-hazelcast-configuration --enabled=true`

*Aim:* Enables Hazelcast, which is disabled by default, as well as allowing
configuration. This command requires the admin server to be running on port
4848, unless specified otherwise.

== Configuring Hazelcast

Payara Server supports configuring Hazelcast through the Admin Console
or asadmin commands, or by using a Hazelcast configuration file. Using
a Hazelcast configuration file will cause the settings in the Admin
Console and _domain.xml_ file to be ignored, with any parameters not
specified in the configuration file reverting to the Hazelcast defaults,
even if they are specified in the Admin Console or _domain.xml_.

=== Configuring Hazelcast with the Admin Console

Navigate to the Hazelcast Configuration page of your instances configuration.
To apply the configuration to multiple instances, ensure that they either
clone, or better, reference the edited configuration.

The following configuration options are available here:

image::/assets/hazelcast-admin-console-hazelcast-options.png[Payara 4.1.2.172 Hazelcast Options]

[cols=",",options="header",]
|====
|Property |Description
|Enabled |Whether or not Hazelcast is enabled.

|Dynamic |Determines if the Hazelcast member embedded in Payara will be
restarted to apply any changes made

|Override Configuration File |Specifies the Hazelcast configuration file
to use. The path specified is relative to the domain config directory.

If you are using a custom GlassFish server configuration for a cluster
or standalone instance (e.g. _cluster-config_), then the Hazelcast
configuration file should be placed in the directory with the same name
(e.g. <domain-root>/config/cluster-config). This will ensure it is
replicated to the node during startup.

Using this option to point to a valid Hazelcast configuration file will cause
all other options set to be ignored. Any options unset within the Hazelcast
configuration file will be set to the Hazelcast defaults.

|Cluster Group Name | Specifies the Hazelcast group name, to be optionally used
 to help divide clusters into logical, segregated groups (i.e. _dev-group_,
   _prod-group_).

|Cluster Group Password |Specifies the password used to access the Hazelcast
group.

|Start Port | The port to run Hazelcast on. If this port is busy, the port
specified will be incremented until a valid port is found.

|Multicast Port |The multicast port for communications in the Hazelcast
cluster.

|Multicast Group |The multicast group for communications in the
Hazelcast cluster.

|JNDI Name |The JNDI name to bind the Hazelcast instance to.

|License Key |Enables
https://hazelcast.com/products/enterprise/[Hazelcast Enterprise]
features.

|Lite |Sets the cluster to lite mode, where it will cluster but *not* store any
cluster data

|Host Aware Partitioning |Whether or not to enable
http://docs.hazelcast.org/docs/latest/manual/html-single/index.html#grouping-types[host-aware
partitioning] for the cluster. Host aware partitioning *must be* enabled
on all members of the cluster (including Payara Micro instances) for
this feature to work correctly.
|====

[[configuring-hazelcast-using-asadmin]]
=== Configuring Hazelcast using Asadmin

The _set-hazelcast_configuration_ asadmin command is used to both
enable/disable Hazelcast, and to configure it. You can pass the _--help_
option to the command to see usage instructions in your terminal.

*Usage:* `asadmin> set-hazelcast-configuration --enabled=true`

*Aim:* Enables Hazelcast, which is disabled by default, as well as allowing
configuration. This command requires the admin server to be running on port
4848, unless specified otherwise.

*Command Options:*

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--enabled`| Boolean| Enables Hazelcast. If no `target` is specified, this
will enable Hazelcast on the domain configuration _(server-config)_.

If no arguments are specified, defaults to _true_.

If other options are specified, asadmin will interactively prompt for
`--enabled`.| _false_ | Yes

|`--target`|Config Name|Specifies the instance or cluster to configure.
|`server-config`|No

|`--dynamic` |Boolean|Enable or disable dynamic stopping and starting of the
embedded Hazelcast member.|_false_|No
|`--hazelcast-configuration-file`

`-f`|File Path |The Hazelcast configuration file to
use. This path is relative to the domain config directory,
`<Payara Installation Directory>/glassfish/domains/<Domain Name>/config/`.

Using this option to point to a valid Hazelcast configuration file will cause
all other options set to be ignored. Any options unset within the Hazelcast
configuration file will be set to the Hazelcast defaults.|`hazelcast-config.xml`
| No

|`--startport` |Port Number|The port to run Hazelcast on. If this port is busy,
the port specified will be incremented until a valid port is found. |5900 |No

|`--multicastgroup`

`-g` |Multicast Address|The multicast group for
communications in the Hazelcast instance.|224.2.2.3|No

|`--multicastport` |Port Number |The multicast port for communications in the Hazelcast
instance.|54327|No

|`--clustername` |Group Name|Specifies the Hazelcast group name, to be
optionally used to help divide clusters into logical, segregated groups (i.e.
_dev-group_, _prod_group_).||No

|`--clusterpassword` |Password|Specifies the password used to access the
Hazelcast group.||No

|`--jndiname`

`-j` |JNDI Name|Specifies the JNDI name to bind the Hazelcast
instance to.||

|`--licensekey`

`-lk` |Hazelcast License|Enables https://hazelcast.com/products/enterprise/[Hazelcast Enterprise]
features.||No

|`--lite` |Boolean|Sets the cluster to lite mode, where it will cluster but *not*
store any cluster data.|_false_|No

|`--hostawarepartitioning` |Boolean|Whether or not to enable
http://docs.hazelcast.org/docs/latest/manual/html-single/index.html#grouping-types[host-aware
partitioning] for the cluster. Host aware partitioning *must be* enabled
on all members of the cluster (including Payara Micro instances) for this
feature to work correctly.|_false_|No

|`--help`

`-?` ||Displays the help menu.|_false_|No
|====

*Example:*

The following example demonstrates setting all of the options on a
cluster called _cluster1_:

`asadmin set-hazelcast-configuration --enabled=true --target=cluster1 --dynamic=true -f hazelcast-config.xml --startport=5902 -g 224.2.2.3 --multicastport=6666 --hostAwareParitioning=true -j payara/Hazelcast`


== Viewing Hazelcast From the Admin Console

=== Viewing Cluster Members

To view cluster members on the admin console:

==== Viewing from an instance

* Select an instance within the cluster you wish to view from the page tree:

image::/assets/hazelcast-admin-console-select-instance.png[Payara 4.1.2.172 Page Tree]

* Open the "Hazelcast" tab and select the "Cluster Members" sub-tab to view
the cluster members page:

image::/assets/hazelcast-admin-console-view-cluster-members.png[Payara 4.1.2.172 Cluster Members]

==== Viewing from the DAS

* If your DAS is Hazelcast-enabled (change the `server-config` if not), select
the "Domain" from the page tree:

image::/assets/hazelcast-admin-console-select-das.png[Payara 4.1.2.172 Page Tree]

* Open the "Hazelcast" tab and select the "Cluster Members" sub-tab to view
the cluster members page:

image::assets/hazelcast-admin-console-view-cluster-members-from-domain.png[Payara 4.1.2.172 Domain Cluster Members]

== Using Hazelcast in your Applications

The following sections will detail how to use the Hazelcast embedded in
Payara within your code.

[[accessing-the-jndi-registered-hazelcast-instance]]
=== Accessing the JNDI registered Hazelcast instance

By default, the JNDI name of the hazelcast instance is
_payara/Hazelcast_. This can be altered with either the
`set-hazelcast-configuration` asadmin command, or via the Admin Console.

You will need to import the following packages into your Java class:

[code,Java]
----
import com.hazelcast.core.HazelcastInstance;
import javax.naming.Context;
import javax.naming.InitialContext;
----

To import the Hazelcast package, you will need to set the Payara
Hazelcast package as a dependency in the project _pom.xml_ file (for
Maven projects), or for you to set the Hazelcast JAR as a project
dependency (if using a non-Maven based project). To add the Payara
Hazelcast package as a dependency in a pom, enter the following in the
dependencies section of your pom:

[code,Maven_POM]
----
<dependency>
    <groupId>fish.payara.appserver</groupId>
    <artifactId>payara-jsr107</artifactId>
    <version>4.1</version>
    <type>jar</type>
    <scope>provided</scope>
</dependency>
----

The Hazelcast JAR (for non-Maven projects), can either be downloaded
from the http://hazelcast.org/download/[Hazelcast website], or you can
make use of the JAR packaged with Payara. The JAR packaged with Payara
can be found at _$\{Product-Root}/glassfish/modules/hazelcast.jar_.

The following will initialise a _HazelcastInstance_ variable with the
instance embedded in Payara:

[code,Java]
----
Context ctx = new InitialContext();
HazelcastInstance instance = (HazelcastInstace) ctx.lookup("payara/Hazelcast");
----

You will have to wrap this in a try-catch clause, or throw the
_Naming Exception_ that this could generate.

[[using-hazelcast-for-the-web-and-ejb-container-persistence]]
== Using Hazelcast for the Web and EJB Container Persistence

You can use Hazelcast as the persistence provider for the Web and EJB
Container in a cluster. Hazelcast must be enabled for this to work (Note, even
if Hazelcast is not enabled, you will still be able to select Hazelcast
as the persistence provider; the persistence will fail in these
circumstances).

[[setting-hazelcast-as-the-persistence-provider-through-the-admin-console]]
=== Setting Hazelcast as the Persistence provider through the Admin Console

_Note that you can always select Hazelcast as a persistence provider, even if
it it not yet enabled._

To set up Hazelcast for persistence:

* Select the instance's configuration from the page tree:

image::/assets/hazelcast-admin-console-select-instance-config.png[Payara 4.1.2.172 Page Tree]

* Select "Availability Service" to view the "Availability Service" page:

image::/assets/hazelcast-admin-console-select-availability-service.png[Payara 4.1.2.172 Availability Service]

==== Setting Web Persistence

* Open the "Web Container Availability" tab, and select "Hazelcast" from the
Persistence Type drop-down menu:

image::/assets/hazelcast-admin-console-availability-enable-web-persistence.png[Payara 4.1.2.172 Web Persistence]

* Save the changes.

==== Setting EJB Persistence

* Open the "EJB Container Availability" tab and select "Hazelcast" from the
Persistence Type drop-down menu:

image::/assets/hazelcast-admin-console-availability-enable-ejb-persistence.png[Payara 4.1.2.172 EJB Persistence]

* Save the changes.

[[setting-hazelcast-as-the-persistence-provider-using-asadmin]]
=== Setting Hazelcast as the Persistence provider using Asadmin

To configure the persistence provider with _asadmin_, you have to use
the _set_ command.

[[for-the-web-container-1]]
==== For the Web Container

To set Hazelcast as the persistence provider of the Web Container, run:
`asadmin set ${Cluster-Config}.availability-service.web-container-availability.persistence-type=hazelcast`

[[for-the-ejb-container-1]]
==== For the EJB Container

To set Hazelcast as the persistence provider of the EJB Container, run:
`asadmin set ${Cluster-Config}.availability-service.ejb-container-availability.sfsb-ha-persistence-type=hazelcast`


[[asadmin-commands]]
== Asadmin Commands

=== `set-hazelcast-configuration`

*Usage:* `asadmin> set-hazelcast-configuration --enabled=true`

*Aim:* Enables Hazelcast, which is disabled by default, as well as allowing
configuration. This command requires the admin server to be running on port
4848, unless specified otherwise.

*Command Options:*

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--enabled`| Boolean| Enables Hazelcast. If no `target` is specified, this
will enable Hazelcast on the domain configuration _(server-config)_.

If no arguments are specified, defaults to _true_.

If other options are specified, asadmin will interactively prompt for
`--enabled`.| _false_ | Yes

|`--target`|Config Name|Specifies the instance or cluster to configure.
|`server-config`|No

|`--dynamic` |Boolean|Enable or disable dynamic stopping and starting of the
embedded Hazelcast member.|_false_|No
|`--hazelcast-configuration-file`

`-f`|File Path |The Hazelcast configuration file to
use. This path is relative to the domain config directory,
`<Payara Installation Directory>/glassfish/domains/<Domain Name>/config/`.

Using this option to point to a valid Hazelcast configuration file will cause
all other options set to be ignored. Any options unset within the Hazelcast
configuration file will be set to the Hazelcast defaults.|`hazelcast-config.xml`
| No

|`--startport` |Port Number|The port to run Hazelcast on. If this port is busy,
the port specified will be incremented until a valid port is found. |5900 |No

|`--multicastgroup`

`-g` |Multicast Address|The multicast group for
communications in the Hazelcast instance.|224.2.2.3|No

|`--multicastport` |Port Number |The multicast port for communications in the Hazelcast
instance.|54327|No

|`--clustername` |Group Name|Specifies the Hazelcast group name, to be
optionally used to help divide clusters into logical, segregated groups (i.e.
_dev-group_, _prod_group_).||No

|`--clusterpassword` |Password|Specifies the password used to access the
Hazelcast group.||No

|`--jndiname`

`-j` |JNDI Name|Specifies the JNDI name to bind the Hazelcast
instance to.||

|`--licensekey`

`-lk` |Hazelcast License|Enables https://hazelcast.com/products/enterprise/[Hazelcast Enterprise]
features.||No

|`--lite` |Boolean|Sets the cluster to lite mode, where it will cluster but *not*
store any cluster data.|_false_|No

|`--hostawarepartitioning` |Boolean|Whether or not to enable
http://docs.hazelcast.org/docs/latest/manual/html-single/index.html#grouping-types[host-aware
partitioning] for the cluster. Host aware partitioning *must be* enabled
on all members of the cluster (including Payara Micro instances) for this
feature to work correctly.|_false_|No

|`--help`

`-?` ||Displays the help menu.|_false_|No
|====

*Example:*

----
asadmin> set-hazelcast-configuration --enabled=true --hostawarepartitioning=true --clustername=Cluster-1 --clusterpassword=Cluster1 --lite
----

=== `create-hazelcast-instance`

*Usage:* `asadmin> create-hazelcast-instance new-instance`

*Aim:* Creates a new Payara Server instance with Hazelcast and the persistence
types.

*Command Options:*

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory

|`--node`|Node Name|Specifies the node to create the instance on.||Yes

|`--config`|Config Name|Specifies the config to use for the instance|
`server-config`|No

|`--lbenabled`|Boolean|Specifies whether the instance is enabled for load
balancing, meaning that the load balancer directs requests to the instance.
|_true_|No

|`--checkports`|Boolean|Specifies whether the check that the administration,
HTTP, JMS, JMX, and IIOP ports are free.|_true_|No

|`--terse`|Boolean|Specifies whether output data should be returned in a
concise format, suited for scripts, with descriptive text omitted.|_false_|No

|`--portbase`|Port Number|Specifies the port to start assigning ports from.
This will always output the assigned ports, even when omitted.||No

|`--systemproperties`|Options|Specifies additional system properties which
will override other settings, such as the assigned port. Examples include
`ASADMIN_LISTENER_PORT` and `OSGI_SHELL_TELNET_PORT`.||No

|`--target`|Config Name|Specifies the instance or cluster to configure.|
`server-config`|No

|`--enabled`|Boolean|Enables Hazelcast. If no target is specified, this will
enable Hazelcast on the domain configuration (_server-config_).

If no arguments are specified, defaults to true.|_true_|No

|`--dynamic`|Boolean|Enable or disable dynamic stopping and starting of the
embedded Hazelcast member.|_false_|No

|`--hazelcastconfigurationfile`/

`-f`|File Path|The Hazelcast configuration file to use. This path is relative to the
domain config directory,
<Payara Installation Directory>/glassfish/domains/<Domain Name>/config/.

Using this option to point to a valid Hazelcast configuration file will cause
all other options set to be ignored. Any options unset within the Hazelcast
configuration file will be set to the Hazelcast defaults|`hazelcast-config.xml`
|No

|`--startport`|Port Number|The port to run Hazelcast on. If this port is busy,
the port specified will be incremented until a valid port is found.|5900|No

|`--multicastgroup`

`-g`|Multicast Address|The multicast group for communications in the Hazelcast
instance.|224.2.2.3|No

|`--multicastport`|Port Number|The multicast port for communications in the
instance.||No

|`--clustername`|Group Name|Specifies the Hazelcase group name, to be
optionally used to help divide clusters into logical, segregated groups (i.e.
  _dev-group_, _prod_grop_).||No

|`--clusterpassword`|Password|Specifies the password used to access the
Hazelcast group.||No

|`--jndiname`

`-j`|JNDI Name|Specifies the JNDI name to bind the Hazelcast instance to.||

|`--licensekey`

`-lk`|Hazelcast License|Enables https://hazelcast.com/products/enterprise/[Hazelcast Enterprise]
features.||No

|`--lite`|Boolean|Sets the cluster to lite mode, where it will cluster but
*not* store any data.|_false_|No

|`--hostawarepartitioning`|Boolean|Whether or not to enable
http://docs.hazelcast.org/docs/latest/manual/html-single/index.html#grouping-types[host-aware
partitioning] for the cluster. Host aware partitioning *must be* enabled
on all members of the cluster (including Payara Micro instances) for this
feature to work correctly.|_false_|No

|`--webpersistence`|Boolean|Specifies whether Hazelcast will be used for web
persistence.|_True_|No

|`--ejbpersistence`|Boolean|Specifies whether Hazelcast will be used for web
persistence.|_True_|No

|`--help`

`-?`||Displays the help menu|_false_|No

|====

*Example:*

----
asadmin> create-hazelcast-instance --webpersistence=false --lite instance2
----
=== `get-hazelcast-configuration`

*Aim:* Return the current Hazelcast configuration.

*Usage:* `asadmin> get-hazelcast-configuration`

*Command Options:*

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--target`|Instance or Cluster Name|Specifies a particular config|
`server`|No
|`--help`

`-?`||Displays the help menu|_fal
|====

*Example:*

----
asadmin> get-hazelcast-configuration
Configuration File    Enabled  Start Port  MulticastGroup  MulticastPort  JNDIName            Lite Member  Cluster Name  Cluster Password  License Key          Host Aware Partitioning
hazelcast-config.xml  true     5900        224.2.2.3       54327          payara/Hazelcast    false        clustername   password          XXXX-XXXX-XXXX-XXXX  false
----

=== `list-hazelcast-cluster-members`

*Aim:* List the current members of the associated Hazelcast cluster.

*Usage:* `asadmin> list-hazelcast-cluster-members`

*Command Options:*

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--type`|`server` or `micro`|Specifies the type of cluster to locate|_Both_|No
|`--help`

`-?`||Displays the help menu|_false_
|====

*Example:*

----
asadmin> list-hazelcast-cluster-members --type server
Instance Name  Instance Group  Instance Type  Host Name  HTTP Ports  HTTPS Ports  Admin Port  Hazelcast Port  Lite Member  Deployed Applications
server         server-config   DAS            127.0.1.1  8080        8181         4848        5901            false        __admingui
----

=== `list-hazelcast-members`

*Aim:* List the hazelcast members.

*Usage:* `asadmin> list-hazelcast-members`

*Command Options:*

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--target`|Instance or cluster name|Specifies the targeted instance or
cluster.|`server`|No
|`--help`

`-?`||Displays the help menu|_false_
|====

*Example:*

----
asadmin> list-hazelcast-members
{ server-/127.0.1.1:5901-this }
----

=== `restart-hazelcast`

*Aim:* Restarts Hazelcast for the target.

*Usage:* `asadmin> restart-hazelcast --target <instance-name>`

*Command Options:*

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--target`|Instance or cluster name|Specifies the targeted instance or
cluster.|`server`|No
|`--help`

`-?`||Displays the help menu|_false_
|====

*Example:*

----
asadmin> restart-hazelcast --target instance-name
instance-name:
Hazelcast Restarted
----

=== `set <cluster-config>.availability-service.web-container-availability.persistence-type=hazelcast`

*Aim:* Sets Hazelcast as the persistence provider of the Web Container.

*Usage:* `asadmin> set <cluster-config>.availability-service.web-container-availability.persistence-type=hazelcast`

=== `set <cluster-config>.availability-service.ejb-container-availability.sfsb-ha-persistence-type=hazelcast`

*Aim:* Sets Hazelcast as the persistence provider of the EJB Container.

*Usage:* `asadmin> availability-service.ejb-container-availability.sfsb-ha-persistence-type=hazelcast`
